#!/usr/bin/env python2
# -*- coding: utf-8 -*-

import sys
import os

from netCDF4 import Dataset, num2date
import pandas as pd
import numpy as np



try:
    fichier = sys.argv[1]
except IndexError:
    sys.exit('Fichier impossible a ouvrir')

path = os.path.dirname(os.path.abspath(fichier))

nc = Dataset(fichier, 'r')
var = list(set(nc.variables.keys()) - set(['time', 'latitude', 'longitude']))[0]
print(var)
dt = nc.variables['time']
dates = num2date(dt[:], dt.units)
print(dt.units)
arr = nc.variables[var][:].filled(np.nan)
lat = nc.variables['latitude'][:]
lon = nc.variables['longitude'][:]
x,y = np.meshgrid(lon,lat)
pxIndex = [str(ll) for ll in zip(x.flatten(),y.flatten())]
print(num2date(dt[0], dt.units))
df = pd.DataFrame(arr.reshape(dates.size,-1), index=dates, columns=pxIndex)
df.to_csv('test.csv', header=True, index=True, index_label='date')
#data = xr.open_dataset(path)
#d = xr.DataArray(data.variables[var])

#for k in listVar:
#    arr = nc.variables[k][:]
#    df = pd.DataFrame(data=arr, index=dates, columns = districts)
#    df.to_csv(os.path.join(path, k+'.csv'), header=True, index=True, index_label='date')
#nc.close()
